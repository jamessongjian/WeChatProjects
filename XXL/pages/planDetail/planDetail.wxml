<view class="plan-container">
  <!-- 标签页 -->
  <view class="tabs">
    <view 
      class="tab {{currentTabIndex === index ? 'active' : ''}}" 
      wx:for="{{planTypes}}" 
      wx:key="id" 
      data-index="{{index}}" 
      bindtap="switchTab"
    >
      {{item.name}}
    </view>
  </view>

  <!-- 规划列表 -->
  <view class="plan-list">
    <block wx:if="{{currentTabIndex === 0}}">
      <view class="plan-item" wx:for="{{plansData.comprehensive}}" wx:key="id">
        <view class="plan-header">
          <view class="plan-title-container">
            <text class="plan-title">规划 {{index + 1}}</text>
            <text class="queue-savings-tip" wx:if="{{item.queueTimeSavingsTip}}">{{item.queueTimeSavingsTip}}</text>
          </view>
          <view class="plan-header-right">
            <view class="plan-stats">
              <text class="plan-time">总时长: {{item.totalTime}}分钟</text>
              <text class="plan-score">评分: {{item.score}}</text>
            </view>
            <button class="favorite-btn {{item.isFavorited ? 'favorited' : ''}}" 
                    bindtap="togglePlanFavorite" 
                    data-plan-type="comprehensive" 
                    data-index="{{index}}">
              <text class="favorite-icon">{{item.isFavorited ? '★' : '☆'}}</text>
              <text class="favorite-text">{{item.isFavorited ? '已收藏' : '收藏'}}</text>
            </button>
          </view>
        </view>
        
        <view class="plan-summary">
          <text class="summary-item">总等待时间: {{item.totalWaitTime}}分钟</text>
          <text class="summary-item">总休息时间: {{item.totalRestTime}}分钟</text>
        </view>
        
        <view class="timeline">
          <view class="timeline-item" wx:for="{{item.items}}" wx:key="id" wx:for-item="subItem">
            <view class="timeline-dot"></view>
            <view class="timeline-line"></view>
            <view class="timeline-content">
              <view class="time-slot">
                <text class="time">{{subItem.startTime}} - {{subItem.endTime}}</text>
                <text class="duration">(游玩: {{subItem.playDuration}}分钟)</text>
              </view>
              <view class="project-card">
                <image class="project-image" src="{{subItem.imageUrl}}" mode="aspectFill" wx:if="{{subItem.imageUrl}}"></image>
                <view class="project-info">
                  <view class="project-name">{{subItem.name}}</view>
                  <view class="project-detail">
                    <text class="queue-time">排队: {{subItem.queueTime}}分钟</text>
                    <text class="rest-time" wx:if="{{subItem.restTime}}">休息: {{subItem.restTime}}分钟</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <block wx:elif="{{currentTabIndex === 1}}">
      <view class="plan-item" wx:for="{{plansData.shortest_wait_time}}" wx:key="id">
        <view class="plan-header">
          <view class="plan-title-container">
            <text class="plan-title">规划 {{index + 1}}</text>
            <text class="queue-savings-tip" wx:if="{{item.queueTimeSavingsTip}}">{{item.queueTimeSavingsTip}}</text>
          </view>
          <view class="plan-header-right">
            <view class="plan-stats">
              <text class="plan-time">总时长: {{item.totalTime}}分钟</text>
              <text class="plan-score">评分: {{item.score}}</text>
            </view>
            <button class="favorite-btn {{item.isFavorited ? 'favorited' : ''}}" 
                    bindtap="togglePlanFavorite" 
                    data-plan-type="shortest_wait_time" 
                    data-index="{{index}}">
              <text class="favorite-icon">{{item.isFavorited ? '★' : '☆'}}</text>
              <text class="favorite-text">{{item.isFavorited ? '已收藏' : '收藏'}}</text>
            </button>
          </view>
        </view>
        
        <view class="plan-summary">
          <text class="summary-item">总等待时间: {{item.totalWaitTime}}分钟</text>
          <text class="summary-item">总休息时间: {{item.totalRestTime}}分钟</text>
        </view>
        
        <view class="timeline">
          <view class="timeline-item" wx:for="{{item.items}}" wx:key="id" wx:for-item="subItem">
            <view class="timeline-dot"></view>
            <view class="timeline-line"></view>
            <view class="timeline-content">
              <view class="time-slot">
                <text class="time">{{subItem.startTime}} - {{subItem.endTime}}</text>
                <text class="duration">(游玩: {{subItem.playDuration}}分钟)</text>
              </view>
              <view class="project-card">
                <image class="project-image" src="{{subItem.imageUrl}}" mode="aspectFill" wx:if="{{subItem.imageUrl}}"></image>
                <view class="project-info">
                  <view class="project-name">{{subItem.name}}</view>
                  <view class="project-detail">
                    <text class="queue-time">排队: {{subItem.queueTime}}分钟</text>
                    <text class="rest-time" wx:if="{{subItem.restTime}}">休息: {{subItem.restTime}}分钟</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <block wx:elif="{{currentTabIndex === 2}}">
      <view class="plan-item" wx:for="{{plansData.earliest_departure}}" wx:key="id">
        <view class="plan-header">
          <view class="plan-title-container">
            <text class="plan-title">规划 {{index + 1}}</text>
            <text class="queue-savings-tip" wx:if="{{item.queueTimeSavingsTip}}">{{item.queueTimeSavingsTip}}</text>
          </view>
          <view class="plan-header-right">
            <view class="plan-stats">
              <text class="plan-time">总时长: {{item.totalTime}}分钟</text>
              <text class="plan-score">评分: {{item.score}}</text>
            </view>
            <button class="favorite-btn {{item.isFavorited ? 'favorited' : ''}}" 
                    bindtap="togglePlanFavorite" 
                    data-plan-type="earliest_departure" 
                    data-index="{{index}}">
              <text class="favorite-icon">{{item.isFavorited ? '★' : '☆'}}</text>
              <text class="favorite-text">{{item.isFavorited ? '已收藏' : '收藏'}}</text>
            </button>
          </view>
        </view>
        
        <view class="plan-summary">
          <text class="summary-item">总等待时间: {{item.totalWaitTime}}分钟</text>
          <text class="summary-item">总休息时间: {{item.totalRestTime}}分钟</text>
        </view>
        
        <view class="timeline">
          <view class="timeline-item" wx:for="{{item.items}}" wx:key="id" wx:for-item="subItem">
            <view class="timeline-dot"></view>
            <view class="timeline-line"></view>
            <view class="timeline-content">
              <view class="time-slot">
                <text class="time">{{subItem.startTime}} - {{subItem.endTime}}</text>
                <text class="duration">(游玩: {{subItem.playDuration}}分钟)</text>
              </view>
              <view class="project-card">
                <image class="project-image" src="{{subItem.imageUrl}}" mode="aspectFill" wx:if="{{subItem.imageUrl}}"></image>
                <view class="project-info">
                  <view class="project-name">{{subItem.name}}</view>
                  <view class="project-detail">
                    <text class="queue-time">排队: {{subItem.queueTime}}分钟</text>
                    <text class="rest-time" wx:if="{{subItem.restTime}}">休息: {{subItem.restTime}}分钟</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>
</view> 