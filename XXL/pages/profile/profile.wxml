<view class="profile-container">
  
  <!-- é¡µé¢æ ‡é¢˜æ  -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„</text>
  </view>

  <!-- ç”¨æˆ·ç™»å½•/ä¿¡æ¯åŒºåŸŸ - ç½®é¡¶è®¾è®¡ -->
  <view class="user-login-section">
    <!-- æœªç™»å½•çŠ¶æ€ - ç»Ÿä¸€é¢æ¿ -->
    <view wx:if="{{!hasUserInfo}}" class="user-card guest-card">
      <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
      <view class="guest-info-section">
        <view class="avatar-name-row">
          <image 
            class="guest-avatar" 
            src="/images/xiaoxiaolu_default_touxiang.jpg"
            mode="aspectFill"
          ></image>
          <view class="name-status">
            <text class="guest-name">å°å°é¹¿momo</text>
            <view class="guest-status-tag">
              <text class="status-text">æ¸¸å®¢</text>
            </view>
          </view>
        </view>
        
        <view class="welcome-message">
          <text class="welcome-text">ğŸ‘‹ æ¬¢è¿æ¥åˆ°å°å°é¹¿æ—…è¡ŒåŠ©æ‰‹</text>
        </view>
        
        <!-- ç™»å½•æŒ‰é’®ç›´æ¥æ”¾åœ¨ä¿¡æ¯åŒºåŸŸå†… -->
        <button class="wechat-login-btn" bindtap="quickLogin">
          <text class="login-icon">ğŸ’¬</text>
          <text class="login-text">å¾®ä¿¡ä¸€é”®ç™»å½•</text>
        </button>
        
        <text class="login-hint">ç™»å½•åå¯æŸ¥çœ‹ç­‰çº§ç­‰ä¸ªäººä¿¡æ¯</text>
      </view>
    </view>
    
    <!-- å·²ç™»å½•çŠ¶æ€ - ç»Ÿä¸€é¢æ¿è®¾è®¡ -->
    <view wx:else class="user-card logged-card">
      <view class="logged-info-section">
        <view class="avatar-name-row">
          <button 
            class="avatar-btn" 
            open-type="chooseAvatar" 
            bindchooseavatar="onChooseAvatar"
          >
            <image 
              class="logged-avatar" 
              src="{{userInfo.avatarUrl || '/images/xiaoxiaolu_default_touxiang.jpg'}}"
              mode="aspectFill"
            ></image>
            <view class="avatar-edit-indicator">
              <text class="edit-icon">âœï¸</text>
            </view>
          </button>
          <view class="name-status">
            <input 
              type="nickname" 
              class="logged-name-input" 
              placeholder="è®¾ç½®æ˜µç§°" 
              bindinput="onNicknameReview" 
              value="{{nickname || userInfo.nickName || 'å°å°é¹¿ç”¨æˆ·'}}" 
            />
            <view class="logged-status-tag {{userType === 'vip' || userType === 'vip1' ? 'vip-tag' : 'normal-tag'}}">
              <text class="status-text">{{userType === 'vip' || userType === 'vip1' ? 'VIPä¼šå‘˜' : 'æ™®é€šç”¨æˆ·'}}</text>
            </view>
          </view>
          <button class="logout-action-btn" bindtap="logout">
            <text class="logout-text">é€€å‡º</text>
          </button>
        </view>
        
        <!-- ä¼šå‘˜ä¿¡æ¯ -->
        <view class="user-stats-row">
          <view class="stat-item">
            <text class="stat-label">ID</text>
            <text class="stat-value">{{userIdDisplay}}</text>
          </view>
          <view wx:if="{{aiAssistantEnabled}}" class="stat-divider"></view>
          <view wx:if="{{aiAssistantEnabled}}" class="stat-item">
            <text class="stat-label">æœ‰æ•ˆæœŸ</text>
            <text class="stat-value">{{vipExpireDisplay}}</text>
          </view>
          <view wx:if="{{aiAssistantEnabled}}" class="stat-divider"></view>
          <view wx:if="{{aiAssistantEnabled}}" class="stat-item">
            <text class="stat-label">æ™ºèƒ½åŠ©æ‰‹</text>
            <text class="stat-value">{{assistantCount}}æ¬¡</text>
          </view>
          <view wx:if="{{aiAssistantEnabled}}" class="stat-divider"></view>
          <view wx:if="{{aiAssistantEnabled}}" class="stat-item">
            <text class="stat-label">æ—…è¡Œè§„åˆ’</text>
            <text class="stat-value">{{planningCount}}æ¬¡</text>
          </view>
        </view>
        
        <!-- ä¼šå‘˜æƒç›Šå¯¹æ¯”è¡¨æ ¼ -->
        <view wx:if="{{aiAssistantEnabled}}" class="membership-comparison">
          <view class="table-header">
            <text class="table-title">ä¼šå‘˜æƒç›Šå¯¹æ¯”</text>
          </view>
          <view class="comparison-table">
            <!-- è¡¨å¤´ -->
            <view class="table-row header-row">
              <view class="table-cell header-cell type-cell">ä¼šå‘˜ç±»å‹</view>
              <view class="table-cell header-cell ads-cell">å…å¹¿å‘Š</view>
              <view class="table-cell header-cell reminder-cell">æé†’åŠŸèƒ½</view>
              <view class="table-cell header-cell assistant-cell">æ™ºèƒ½åŠ©æ‰‹</view>
              <view class="table-cell header-cell planning-cell">æ—…è¡Œè§„åˆ’</view>
              <view class="table-cell header-cell price-cell">è´¹ç”¨</view>
            </view>
            
            <!-- æ™®é€šç”¨æˆ· -->
            <view class="table-row data-row {{userType === 'normal' ? 'current-plan' : ''}}">
              <view class="table-cell type-cell">
                <text class="member-type">æ™®é€š</text>
                <text class="current-badge" wx:if="{{userType === 'normal'}}">å½“å‰</text>
              </view>
              <view class="table-cell ads-cell">æ— </view>
              <view class="table-cell reminder-cell">æ— </view>
              <view class="table-cell assistant-cell">0æ¬¡</view>
              <view class="table-cell planning-cell">0æ¬¡</view>
              <view class="table-cell price-cell">å…è´¹</view>
            </view>
            
            <!-- VIPç”¨æˆ· -->
            <view class="table-row data-row {{userType === 'vip' || userType === 'vip1' ? 'current-plan' : ''}}">
              <view class="table-cell type-cell">
                <text class="member-type">VIP</text>
                <text class="current-badge" wx:if="{{userType === 'vip' || userType === 'vip1'}}">å½“å‰</text>
              </view>
              <view class="table-cell ads-cell">1ä¸ªæœˆ</view>
              <view class="table-cell reminder-cell">1ä¸ªæœˆ</view>
              <view class="table-cell assistant-cell">+5æ¬¡</view>
              <view class="table-cell planning-cell">+5æ¬¡</view>
              <view class="table-cell price-cell">
                <button class="upgrade-btn vip-btn" bindtap="showPaymentModal" data-plan="vip">2å…ƒå‡çº§</button>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>


  <!-- æˆ‘çš„æé†’å¡ç‰‡ - æ–°å¢ç‹¬ç«‹åŒºåŸŸ -->
  <view class="reminders-card">
    <view class="reminders-card-header">
      <view class="reminders-card-title">
        <text class="reminders-icon">â°</text>
        <text class="reminders-title-text">æˆ‘çš„æé†’</text>
      </view>
      <view class="reminders-card-count" wx:if="{{reminders && reminders.length > 0}}">
        <text class="count-badge">{{reminders.length}}</text>
      </view>
    </view>
    
    <view class="reminders-content" wx:if="{{reminders && reminders.length > 0}}">
      <block wx:for="{{reminders}}" wx:key="id">
        <view class="reminder-item" bindtap="viewReminderDetail" data-index="{{index}}">
          <view class="reminder-info">
            <view class="performance-name">{{item.performanceName}}</view>
            <view class="performance-time">
              <text class="time-label">æ¼”å‡ºåœºæ¬¡ï¼š</text>
              <text class="show-time">{{item.showTime}}</text>
              <text class="duration-label">æ¼”å‡ºæ—¶é•¿ï¼š</text>
              <text class="duration">{{item.duration}}</text>
            </view>
            <view class="reminder-details">
              <text class="park-name">{{item.parkName}}</text>
              <text class="reminder-date">{{item.reminderDate}}</text>
              <text class="advance-time">{{item.advanceText}}</text>
            </view>
          </view>
          
          <view class="reminder-actions" catchtap="preventBubble">
            <button class="nav-btn" bindtap="navigateToPerformance" data-index="{{index}}">å¯¼èˆª</button>
            <button class="delete-btn" bindtap="deleteReminder" data-index="{{index}}">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>
    
    <view class="no-reminders" wx:else>
      <text class="no-reminders-icon">â°</text>
      <text class="no-reminders-text">æš‚æ— æé†’</text>
      <text class="no-reminders-desc">åœ¨æ¼”å‡ºè¯¦æƒ…é¡µè®¾ç½®æé†’åä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>

    </view>
  </view>

  <!-- æˆ‘çš„æ”¶è—å¡ç‰‡ -->
  <view class="favorite-plans-card">
    <view class="favorite-plans-card-header">
      <view class="favorite-plans-card-title">
        <text class="favorite-plans-icon">â­</text>
        <text class="favorite-plans-title-text">æˆ‘çš„è¡Œç¨‹æ”¶è—</text>
      </view>
      <view class="favorite-plans-card-count" wx:if="{{favoritePlans && favoritePlans.length > 0}}">
        <text class="count-badge">{{favoritePlans.length}}</text>
      </view>
    </view>
    
    <view class="favorite-plans-content" wx:if="{{favoritePlans && favoritePlans.length > 0}}">
      <block wx:for="{{favoritePlans}}" wx:key="id">
        <view class="favorite-plan-item" bindtap="viewFavoritePlanDetail" data-index="{{index}}">
          <view class="favorite-plan-info">
            <view class="plan-type-name">{{item.planTypeName}} - è§„åˆ’ {{item.originalIndex + 1}}</view>
            <view class="plan-summary-info">
              <text class="wait-time-label">æ€»æ’é˜Ÿï¼š</text>
              <text class="wait-time">{{item.planData.totalWaitTime}}åˆ†é’Ÿ</text>
              <text class="departure-label">ç¦»å›­ï¼š</text>
              <text class="departure-time">{{item.planData.departureTime || 'æœªçŸ¥'}}</text>
            </view>
            <view class="favorite-plan-details">
              <text class="park-name">{{item.parkName}}</text>
              <text class="created-date">æ”¶è—äº {{item.createdDate}}</text>
              <text class="queue-savings" wx:if="{{item.planData.queueTimeSavingsTip}}">{{item.planData.queueTimeSavingsTip}}</text>
            </view>
          </view>
          
          <view class="favorite-plan-actions" catchtap="preventBubble">
            <button class="view-btn" bindtap="viewFavoritePlan" data-index="{{index}}">æŸ¥çœ‹</button>
            <button class="delete-btn" bindtap="deleteFavoritePlan" data-index="{{index}}">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>
    
    <view class="no-favorite-plans" wx:else>
      <text class="no-favorite-plans-icon">â­</text>
      <text class="no-favorite-plans-text">æš‚æ— æ”¶è—</text>
      <text class="no-favorite-plans-desc">åœ¨è§„åˆ’é¡µé¢æ”¶è—å¿ƒä»ªçš„è¡Œç¨‹åä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
    </view>
  </view>

  <!-- æˆ‘çš„åœ°ç‚¹æ”¶è—å¡ç‰‡ -->
  <view class="project-favorites-card">
    <view class="project-favorites-card-header">
      <view class="project-favorites-card-title">
        <text class="project-favorites-icon">ğŸ­</text>
        <text class="project-favorites-title-text">æˆ‘çš„åœ°ç‚¹æ”¶è—</text>
      </view>
      <view class="project-favorites-card-count" wx:if="{{projectFavorites && projectFavorites.length > 0}}">
        <text class="count-badge">{{projectFavorites.length}}</text>
      </view>
    </view>
    
    <view class="project-favorites-content" wx:if="{{projectFavorites && projectFavorites.length > 0}}">
      <block wx:for="{{projectFavorites}}" wx:key="id">
        <view class="project-favorite-item" bindtap="viewProjectFavoriteDetail" data-index="{{index}}">
          <view class="project-favorite-info">
            <view class="project-name">{{item.name}}</view>
            <view class="project-type-info">
              <text class="type-label">ç±»å‹ï¼š</text>
              <text class="project-type">{{item.typeName}}</text>
              <text class="location-label">ä½ç½®ï¼š</text>
              <text class="project-location">{{item.location}}</text>
            </view>
            <view class="project-favorite-details">
              <text class="park-name">{{item.parkName}}</text>
              <text class="created-date">æ”¶è—äº {{item.createdDate}}</text>
              <text class="project-status" wx:if="{{item.waitTime}}">{{item.waitTime}}</text>
            </view>
          </view>
          
          <view class="project-favorite-actions" catchtap="preventBubble">
            <button class="view-btn" bindtap="viewProjectFavorite" data-index="{{index}}">æŸ¥çœ‹</button>
            <button class="delete-btn" bindtap="deleteProjectFavorite" data-index="{{index}}">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>
    
    <view class="no-project-favorites" wx:else>
      <text class="no-project-favorites-icon">ğŸ­</text>
      <text class="no-project-favorites-text">æš‚æ— åœ°ç‚¹æ”¶è—</text>
      <text class="no-project-favorites-desc">åœ¨æ¼”å‡ºæˆ–æ¸¸ä¹é¡¹ç›®è¯¦æƒ…é¡µæ”¶è—åä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
    </view>
  </view>
  
  
  <!-- VIPå‡çº§æ¨¡æ€æ¡† -->
  <view class="vip-modal-overlay" wx:if="{{showVipModal}}" bindtap="hideVipUpgrade">
    <view class="vip-modal" catchtap="noop">
      <view class="vip-modal-header">
        <text class="vip-modal-title">ä¼šå‘˜å‡çº§å¥—é¤</text>
        <text class="vip-modal-close" bindtap="hideVipUpgrade">Ã—</text>
      </view>
      
      <view class="vip-plans-container">
        <block wx:for="{{vipPlans}}" wx:key="id">
          <view class="vip-plan-card {{item.isCurrentPlan ? 'current-plan' : ''}}" style="border-color: {{item.color}};">
            <!-- æ¨èæ ‡ç­¾ -->
            <view class="recommend-badge" wx:if="{{item.isRecommended}}">æ¨è</view>
            <!-- å½“å‰æ–¹æ¡ˆæ ‡ç­¾ -->
            <view class="current-badge" wx:if="{{item.isCurrentPlan}}">å½“å‰æ–¹æ¡ˆ</view>
            
            <view class="plan-header" style="background-color: {{item.color}};">
              <text class="plan-name">{{item.name}}</text>
              <text class="plan-price">{{item.price}}</text>
            </view>
            
            <view class="plan-features">
              <view class="feature-summary">
                <view class="feature-item">
                  <text class="feature-label">å…å¹¿å‘Š</text>
                  <text class="feature-value {{item.adFree === 'x' ? 'feature-disabled' : 'feature-enabled'}}">{{item.adFree}}</text>
                </view>
                
                <view class="feature-item">
                  <text class="feature-label">æ¸¸ç©è§„åˆ’</text>
                  <text class="feature-value {{item.planCount === '0æ¬¡' ? 'feature-disabled' : 'feature-enabled'}}">{{item.planCount}}</text>
                </view>
                
                <view class="feature-item">
                  <text class="feature-label">æ™ºèƒ½åŠ©æ‰‹</text>
                  <text class="feature-value {{item.assistantCount === '0æ¬¡' ? 'feature-disabled' : 'feature-enabled'}}">{{item.assistantCount}}</text>
                </view>
              </view>
              
              <view class="benefits-list">
                <text class="benefits-title">ä¸“äº«æƒç›Š</text>
                <block wx:for="{{item.benefits}}" wx:key="*this" wx:for-item="benefit">
                  <view class="benefit-item">
                    <text class="benefit-icon">âœ“</text>
                    <text class="benefit-text">{{benefit}}</text>
                  </view>
                </block>
              </view>
            </view>
            
            <view class="plan-action">
              <button 
                class="purchase-btn {{item.isCurrentPlan ? 'current-btn' : ''}}" 
                style="background-color: {{item.isCurrentPlan ? '#cccccc' : item.color}};"
                bindtap="purchaseVipPlan" 
                data-plan-id="{{item.id}}"
                disabled="{{item.isCurrentPlan}}"
              >
                {{item.isCurrentPlan ? 'å½“å‰æ–¹æ¡ˆ' : (item.id === 'normal' ? 'å…è´¹ä½¿ç”¨' : 'ç«‹å³è´­ä¹°')}}
              </button>
            </view>
          </view>
        </block>
      </view>
      
      <view class="vip-modal-footer">
        <text class="vip-modal-note">* è´­ä¹°åç«‹å³ç”Ÿæ•ˆï¼Œæ”¯æŒå¾®ä¿¡æ”¯ä»˜</text>
      </view>
    </view>
  </view>

  <!-- æ”¯ä»˜å¼¹çª— -->
  <view class="payment-modal" wx:if="{{showPaymentModal}}">
    <view class="payment-modal-mask" bindtap="hidePaymentModal"></view>
    <view class="payment-modal-content">
      <view class="payment-modal-header">
        <text class="payment-modal-title">å‡çº§{{selectedPlan.name}}</text>
        <view class="payment-modal-close" bindtap="hidePaymentModal">Ã—</view>
      </view>
      
      <view class="payment-modal-body">
        <!-- å¥—é¤ä¿¡æ¯ -->
        <view class="payment-plan-info">
          <view class="payment-plan-name">{{selectedPlan.name}}</view>
          <view class="payment-plan-price">Â¥{{selectedPlan.price}}</view>
        </view>
        
        <!-- æƒç›Šåˆ—è¡¨ -->
        <view class="payment-benefits">
          <text class="payment-benefits-title">å‡çº§åäº«æœ‰æƒç›Šï¼š</text>
          <view class="payment-benefit-item" wx:for="{{selectedPlan.benefits}}" wx:key="index">
            <text class="payment-benefit-icon">âœ“</text>
            <text class="payment-benefit-text">{{item}}</text>
          </view>
        </view>
        
        <!-- æ”¯ä»˜ä¿¡æ¯ -->
        <view class="payment-info">
          <view class="payment-info-row">
            <text class="payment-info-label">å¥—é¤è´¹ç”¨ï¼š</text>
            <text class="payment-info-value">Â¥{{selectedPlan.price}}</text>
          </view>
          <view class="payment-info-row">
            <text class="payment-info-label">æ”¯ä»˜æ–¹å¼ï¼š</text>
            <text class="payment-info-value">å¾®ä¿¡æ”¯ä»˜</text>
          </view>
        </view>
      </view>
      
      <view class="payment-modal-footer">
        <button class="payment-cancel-btn" bindtap="hidePaymentModal">å–æ¶ˆ</button>
        <button class="payment-confirm-btn" bindtap="processPayment">ç«‹å³æ”¯ä»˜(æµ‹è¯•)</button>
      </view>
    </view>
  </view>

</view> 